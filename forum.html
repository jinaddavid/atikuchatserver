<html>
  <head>
    <title>Atiku forum dommy</title>
<!--    <script src="socket.io.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <script src = "http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <script src = "client.js"></script>
    <script>
//    $(document).ready(function(){
//          var socket = io();
//          $("#add_status").click(function(){
//            socket.emit('status added',$("#comment").val());
//          });
//          $("#add_status").click(function(){
//            socket.emit('connection',$("#comment").val());
//          });
//          socket.on('refresh feed',function(msg){
//            $("#show_comments").append(msg + '<br /><br />');
//          });
//    });
    </script>
  </head>
  <body>
      <div class="page-main">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">
            <a class="pull-left" href="javascript:void(0)">
              <i class="icon md-chevron-left" aria-hidden="true"></i>
            </a>
            <div class="text-right">
              Conversation with June Lane
              <a class="avatar margin-left-15" data-toggle="tooltip" href="#" data-placement="left"
              title="June Lane">
                <img src="../../../global/portraits/4.jpg" alt="...">
              </a>
            </div>
          </div>
        </div>
        <div class="panel-body">
          <!-- Chat Box -->
          <div class="chats-wrap">
            <button type="button" id="historyBtn" class="btn btn-round btn-default">Load Old Messages</button>
            <div class="chats">
              <div class="chat">
                <div class="chat-body">
                  <div class="chat-content" data-toggle="tooltip" title="8:30 am">
                    <p>
                      Hello. What can I do for you?
                    </p>
                  </div>
                </div>
              </div>
              <div class="chat chat-right">
                <div class="chat-body">
                  <div class="chat-content" data-toggle="tooltip" title="8:35 am">
                    <p>
                      I'm just looking around.
                    </p>
                    <p>Will you tell me something about yourself? </p>
                  </div>
                  <div class="chat-content" data-toggle="tooltip" title="8:40 am">
                    <p>
                      Are you there? That time!
                    </p>
                  </div>
                </div>
              </div>
              <div class="chat">
                <div class="chat-body">
                  <div class="chat-content" data-toggle="tooltip" title="8:35 am">
                    <p>
                      Where?
                    </p>
                  </div>
                  <div class="chat-content" data-toggle="tooltip" title="8:42 am">
                    <p>
                      OK, my name is Limingqiang. I like singing, playing basketballand so on.
                    </p>
                  </div>
                </div>
              </div>
              <div class="chat chat-right">
                <div class="chat-body">
                  <div class="chat-content" data-toggle="tooltip" title="8:49 am">
                    <p>You wait for notice.</p>
                  </div>
                  <div class="chat-content" data-toggle="tooltip" title="8:50 am">
                    <p>Consectetuorem ipsum dolor sit?</p>
                  </div>
                  <div class="chat-content" data-toggle="tooltip" title="8:55 am">
                    <p>OK?</p>
                  </div>
                </div>
              </div>
              <div class="chat">
                <div class="chat-body">
                  <div class="chat-content" data-toggle="tooltip" title="9:00 am">
                    <p>OK!</p>
                  </div>
                </div>
              </div>
            </div>

          </div>
          <!-- End Chat Box -->
        </div>
      </div>

      <!-- Message Input-->
      <!--<form class="app-message-input" action="#">-->
        <div class="input-group form-material">
          <span class="input-group-btn">
            <a href="javascript: void(0)" class="btn btn-pure btn-default icon md-camera"></a>
          </span>
          <input class="form-control" type="text" placeholder="Type message here ..." id="msg_input_pm">
          <span class="input-group-btn">
            <button type="button" class="btn btn-pure btn-default icon md-mail-send"></button>
          </span>
        </div>
      <!--</form>-->
      <!-- End Message Input-->

    </div> 


      <!--<img src="http://localhost/atikuApi/uploads/userdp/default.jpg" alt="image" style="width:80px;height: 80px;" />-->
<!--    <div id="comment_box" style = "padding:5%;">
        <input type="text" id="msg_input_pm"> <br /><br />
      <input type="button" id="add_status" value="send">
    </div>
      <div
       id    = "show_comments"
       class = "jumbotron"
       style = "width: 38%;
                height: 100%;
                padding: 2%;
                margin-left:5%;
                margin-top:-53px;"
     >
      </div>-->
      <script>
  
          ////alert("h");
//          var current_chatting = "";
var iosocket, recid, recieving = "false";
var user_details;
var doctorlist, caller;
var reject;
var data, loca;
var personal;
var calltype;
var user_id;
        $(document).ready(function() {
           
//             
              //    19
    user_id = "james@gmail.com";
      sender_name="james"; 
//      console.log("current chatting"+user_id)
//   22
//        user_id = "wilson@gmail.com";
// sender_name="ola";
//        user_id = "mymail@gmail.com";
// sender_name="toriola";
        //    user_id = "19";
    sender = user_id ;//"tosyngy";//;
//    sender_name = $("#user").val();
    recid = sender;
//      personal = "test@name.com";
      current_chatting="admin1@gmail.com";
//      current_chatting="admin1@gmail.com";

});
var recordState = function(state) {
    window.localStorage.setItem("loca", state);
};

var getState = function() {
    return window.localStorage.getItem("loca");
};

var gotoLocation = function(addr) {
    window.location = addr;
};

var conThread = function() {
//    temp = window.localStorage.getItem("medslat_user_details");
//    user_details = JSON.parse(temp);
//    //alert(loca);

//    if (user_details === null) {
////        loca = "login";
//        gotoLocation("login.html");
//    } else {
////        loca = getState();
//    }

//    iosocket = io.connect('http://localhost:8080');
    iosocket = io.connect('https://polar-forest-71145.herokuapp.com/');
//    personal = "checkmate@email.com";
//    personal = "james@gmail.com";
//    personal = "wilson@gmail.com";
//    19
//    user_id = "APA91bFRtR8iGPPhWw_BSr3YuZok16K2zaw27Mrzc6wuAlOYIlNJchcujeBVnN2G0wVIaoL30VXKhBpfjWZFpx10XfJQFUj6HJ9G2lkOLkmQr5aiLPtFDRkQIisDeuRMeOQrD5_pE1ncCCc9y1JhTXXwDobAg327Mg";
//   22
//        user_id = "APA91bGFPuMNVx-4CW0K1R3Qhr8243z4L0AchMvA1wnSpfHavzyTo5yhP270j6pVNbTuOWcC4sSsamtSaaMZ8bfaG5HYzigOa_dEo6SkJVybel010elI3vgHV8_mKFl9xfeCLbsSpY0ty83jX2LYEcHHBrJpD7kWEw";
//    user_id = "19";
//    
//    em=personal;
//    //alert(personal);
    iosocket.on("connect", function(){
//     iosocket.emit("register", recid);
 
     iosocket.emit("register", user_id);
      console.log("current user"+user_id);
  console.log("current chatting"+current_chatting);
            window.localStorage.setItem("my_id", user_id);
    });
  iosocket.on("note", function(data) {
//        //alert(data);
//      var user = new User(socket);
console.log("here ooo"+data);
    });


    iosocket.on("users_update", function(array) {
                var size = array.length;
                console.log("online users" + size);
                console.log(array);
              // list all connected user to the node
            });

$(document).on('keyup', "#msg_input_pm", function(event) {
    event.preventDefault();
                console.log("event.keyCode: " + event.keyCode);
                console.log(event);
//                var doc = $("#receiver").val();
//                var out = {
//                    message: "typing...",
//                    user1id: sender,
//                    user1un: sender_name,
//                    user2id: current_chatting,
//                    status: 0,
//                    time: ""
//                };
//                iosocket.emit("ty", out);
console.log("here")
                if (event.keyCode === 13) {
                    var val = $("#msg_input_pm").val().trim();
                    var lenght = val.length;
                    if (lenght < 1) {
                        alert('cannot send empty message');
                        return;
                    }
                    event.preventDefault();
                    var out = {
                        message: val,
                        user1id: sender,
                        user1un: sender_name,
                        topic_id: 2,
                        status: 0,
                        time: ""
                    };
                    iosocket.emit("msgforum", out);
                    $('#msg_input_pm').text('');
                }
            });
           
  iosocket.on('f_status_sent', function(msg) {
               $('.chats').append($(" <div class='chat'><div class='chat-body'><div class='chat-content' data-toggle='tooltip' title='8:30 am'><p>"+msg.message+"</p></div></div></div>"));
            var wtf = $('#my_chat_body');
            var height = wtf[0].scrollHeight;
            wtf.scrollTop(height);
            });

  

    iosocket.on('text', function(data) {
        $('#chat').prepend($('<p>').text(data.username + ': ' + data.text));
    });

    iosocket.on('f_message', function(message) {
//        alert("u av a new message");
        alert(message.message)
        console.log(message)
        console.log(message.user1id)
        var test = window.localStorage.getItem("chat_with");
        alert(test+"current chatting with")
        if (test == message.user1id) {
            $('.chats').append($(" <div class='chat'><div class='chat-body'><div class='chat-content' data-toggle='tooltip' title='8:30 am'><p>"+message.message+"</p></div></div></div>"));
            var wtf = $('#my_chat_body');
            var height = wtf[0].scrollHeight;
            wtf.scrollTop(height);
        }
//                if (test != message.user2un) {
//                     if ($("#mspn_ph").val() == "") {
//                     } else {
//                         if (test !== message.user1un) {
//                             var prev_notf = Number($("#mspn_ph").val());
//                            $("#mspn").text(prev_notf + 1);
//                            $("#mspn_ph").val(prev_notf + 1);
//                            last_sender = message.user1un;
//                        }
//
//                    }
// 
//                } else { 
//                }
    });

    iosocket.on("user_in", function(data) {
//        //alert(data);
        user = data;
        if (user.name === session_name) {
            return;
        }
        var row = '<div  class="contact" id="display_' + user.name + '" pingId="' + user.name + '">'
                + '<img src="' + user.dp + '" alt="" class="contact__photo" id="display_picture_' + user.name + '">'
                + '<span class="contact__name ' + user.name + '">' + user.name + '</span>'
                + ' <span class="contain_control">'
                + ' <img class="call_pin btn_control" pingId="' + user.name + '" src="./images/1.png"> '
                + ' <img class="vid_pin btn_control"  pingId="' + user.name + '" src="./images/2.png"> '
                + '</span>'
                + '</div>';
        $(".contact_list").prepend(row);
//        console.log(data);
//      var user = new User(socket);
    });

    iosocket.on("wentOffline", function(name) {
        $("#display_" + name).slideUp("slow");
    });

  

 

//audio_call_rejected
};
conThread();

//============================== Click Events===============================================

$(document).on('click', ".history_item", function() {
//    loca = "chat";
    var loc = $(this).attr("rel");
    var loc_user = $(this).attr("rel_user");
//    //alert(loc);
//    //alert(loc_user);
//    window.m.chatWith(loc);
    window.localStorage.setItem("chat_with", loc);
    window.localStorage.setItem("chat_with_username", loc_user);
//    window.location = "chat.html";
    $("body").empty();
    $("body").load("chat.html");
});

$(document).on('touchstart', ".reciever_dp", function() {
//    loca = "profile";

    $("body").load("profile.html");
});

$(document).on("touchstart", ".back_btn_recent", function(e) {

//    $("body").empty();
//        ("hMenu.html");
//    //alert(count("<body>"));
    $("body").load("hMenu.html");
//    location.reload();
});
$(document).on("touchstart", ".back_btn_chat", function(e) {

    $("body").load("recent.html");
});

$(document).on('touchstart', ".my_profile_home", function() {
//    loca = "my_profile";

    $("body").load("my_profile.html");
});



$(document).on('touchstart', ".audio_call", function() {
//    loca = "my_profile";
    $("body").empty();
    calltype="audio";
 $("body").load("vid_out.html");
    


});

$(document).on('touchstart', ".video_call", function() {
//    loca = "my_profile";
//    //alert("video");
calltype="video";
    $("body").empty();
    $("body").load("vid_out.html");
});

      </script>
  </body>
</html>




















 